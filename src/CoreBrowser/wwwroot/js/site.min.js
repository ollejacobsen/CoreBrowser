(function(){"use strict";var t,i;t=jQuery,i=function(i,e){var o,s,a;return this.options=t.extend({title:null,footer:null,remote:null},t.fn.ekkoLightbox.defaults,e||{}),this.$element=t(i),o="",this.modal_id=this.options.modal_id?this.options.modal_id:"ekkoLightbox-"+Math.floor(1e3*Math.random()+1),a='<div class="modal-header"'+(this.options.title||this.options.always_show_close?"":' style="display:none"')+'><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">'+(this.options.title||"&nbsp;")+"</h4></div>",s='<div class="modal-footer"'+(this.options.footer?"":' style="display:none"')+">"+this.options.footer+"</div>",t(document.body).append('<div id="'+this.modal_id+'" class="ekko-lightbox modal fade" tabindex="-1"><div class="modal-dialog"><div class="modal-content">'+a+'<div class="modal-body"><div class="ekko-lightbox-container"><div></div></div></div>'+s+"</div></div></div>"),this.modal=t("#"+this.modal_id),this.modal_dialog=this.modal.find(".modal-dialog").first(),this.modal_content=this.modal.find(".modal-content").first(),this.modal_body=this.modal.find(".modal-body").first(),this.modal_header=this.modal.find(".modal-header").first(),this.modal_footer=this.modal.find(".modal-footer").first(),this.lightbox_container=this.modal_body.find(".ekko-lightbox-container").first(),this.lightbox_body=this.lightbox_container.find("> div:first-child").first(),this.showLoading(),this.modal_arrows=null,this.border={top:parseFloat(this.modal_dialog.css("border-top-width"))+parseFloat(this.modal_content.css("border-top-width"))+parseFloat(this.modal_body.css("border-top-width")),right:parseFloat(this.modal_dialog.css("border-right-width"))+parseFloat(this.modal_content.css("border-right-width"))+parseFloat(this.modal_body.css("border-right-width")),bottom:parseFloat(this.modal_dialog.css("border-bottom-width"))+parseFloat(this.modal_content.css("border-bottom-width"))+parseFloat(this.modal_body.css("border-bottom-width")),left:parseFloat(this.modal_dialog.css("border-left-width"))+parseFloat(this.modal_content.css("border-left-width"))+parseFloat(this.modal_body.css("border-left-width"))},this.padding={top:parseFloat(this.modal_dialog.css("padding-top"))+parseFloat(this.modal_content.css("padding-top"))+parseFloat(this.modal_body.css("padding-top")),right:parseFloat(this.modal_dialog.css("padding-right"))+parseFloat(this.modal_content.css("padding-right"))+parseFloat(this.modal_body.css("padding-right")),bottom:parseFloat(this.modal_dialog.css("padding-bottom"))+parseFloat(this.modal_content.css("padding-bottom"))+parseFloat(this.modal_body.css("padding-bottom")),left:parseFloat(this.modal_dialog.css("padding-left"))+parseFloat(this.modal_content.css("padding-left"))+parseFloat(this.modal_body.css("padding-left"))},this.modal.on("show.bs.modal",this.options.onShow.bind(this)).on("shown.bs.modal",function(t){return function(){return t.modal_shown(),t.options.onShown.call(t)}}(this)).on("hide.bs.modal",this.options.onHide.bind(this)).on("hidden.bs.modal",function(i){return function(){return i.gallery&&t(document).off("keydown.ekkoLightbox"),i.modal.remove(),i.options.onHidden.call(i)}}(this)).modal("show",e),this.modal},i.prototype={modal_shown:function(){var i;return this.options.remote?(this.gallery=this.$element.data("gallery"),this.gallery&&(this.gallery_items="document.body"===this.options.gallery_parent_selector||""===this.options.gallery_parent_selector?t(document.body).find('*[data-gallery="'+this.gallery+'"]'):this.$element.parents(this.options.gallery_parent_selector).first().find('*[data-gallery="'+this.gallery+'"]'),this.gallery_index=this.gallery_items.index(this.$element),t(document).on("keydown.ekkoLightbox",this.navigate.bind(this)),this.options.directional_arrows&&this.gallery_items.length>1&&(this.lightbox_container.append('<div class="ekko-lightbox-nav-overlay"><a href="#" class="'+this.strip_stops(this.options.left_arrow_class)+'"></a><a href="#" class="'+this.strip_stops(this.options.right_arrow_class)+'"></a></div>'),this.modal_arrows=this.lightbox_container.find("div.ekko-lightbox-nav-overlay").first(),this.lightbox_container.find("a"+this.strip_spaces(this.options.left_arrow_class)).on("click",function(t){return function(i){return i.preventDefault(),t.navigate_left()}}(this)),this.lightbox_container.find("a"+this.strip_spaces(this.options.right_arrow_class)).on("click",function(t){return function(i){return i.preventDefault(),t.navigate_right()}}(this)))),this.options.type?"image"===this.options.type?this.preloadImage(this.options.remote,!0):"youtube"===this.options.type&&(i=this.getYoutubeId(this.options.remote))?this.showYoutubeVideo(i):"vimeo"===this.options.type?this.showVimeoVideo(this.options.remote):"instagram"===this.options.type?this.showInstagramVideo(this.options.remote):"url"===this.options.type?this.loadRemoteContent(this.options.remote):"video"===this.options.type?this.showVideoIframe(this.options.remote):this.error('Could not detect remote target type. Force the type using data-type="image|youtube|vimeo|instagram|url|video"'):this.detectRemoteType(this.options.remote)):this.error("No remote target given")},strip_stops:function(t){return t.replace(/\./g,"")},strip_spaces:function(t){return t.replace(/\s/g,"")},isImage:function(t){return t.match(/(^data:image\/.*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp|svg)((\?|#).*)?$)/i)},isSwf:function(t){return t.match(/\.(swf)((\?|#).*)?$/i)},getYoutubeId:function(t){var i;return i=t.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/),i&&11===i[2].length?i[2]:!1},getVimeoId:function(t){return t.indexOf("vimeo")>0?t:!1},getInstagramId:function(t){return t.indexOf("instagram")>0?t:!1},navigate:function(t){if(t=t||window.event,39===t.keyCode||37===t.keyCode){if(39===t.keyCode)return this.navigate_right();if(37===t.keyCode)return this.navigate_left()}},navigateTo:function(i){var e,o;return 0>i||i>this.gallery_items.length-1?this:(this.showLoading(),this.gallery_index=i,this.$element=t(this.gallery_items.get(this.gallery_index)),this.updateTitleAndFooter(),o=this.$element.attr("data-remote")||this.$element.attr("href"),this.detectRemoteType(o,this.$element.attr("data-type")||!1),this.gallery_index+1<this.gallery_items.length&&(e=t(this.gallery_items.get(this.gallery_index+1),!1),o=e.attr("data-remote")||e.attr("href"),"image"===e.attr("data-type")||this.isImage(o))?this.preloadImage(o,!1):void 0)},navigate_left:function(){return 1!==this.gallery_items.length?(0===this.gallery_index?this.gallery_index=this.gallery_items.length-1:this.gallery_index--,this.options.onNavigate.call(this,"left",this.gallery_index),this.navigateTo(this.gallery_index)):void 0},navigate_right:function(){return 1!==this.gallery_items.length?(this.gallery_index===this.gallery_items.length-1?this.gallery_index=0:this.gallery_index++,this.options.onNavigate.call(this,"right",this.gallery_index),this.navigateTo(this.gallery_index)):void 0},detectRemoteType:function(t,i){var e;return i=i||!1,"image"===i||this.isImage(t)?(this.options.type="image",this.preloadImage(t,!0)):"youtube"===i||(e=this.getYoutubeId(t))?(this.options.type="youtube",this.showYoutubeVideo(e)):"vimeo"===i||(e=this.getVimeoId(t))?(this.options.type="vimeo",this.showVimeoVideo(e)):"instagram"===i||(e=this.getInstagramId(t))?(this.options.type="instagram",this.showInstagramVideo(e)):"video"===i?(this.options.type="video",this.showVideoIframe(e)):(this.options.type="url",this.loadRemoteContent(t))},updateTitleAndFooter:function(){var t,i,e,o;return e=this.modal_content.find(".modal-header"),i=this.modal_content.find(".modal-footer"),o=this.$element.data("title")||"",t=this.$element.data("footer")||"",o||this.options.always_show_close?e.css("display","").find(".modal-title").html(o||"&nbsp;"):e.css("display","none"),t?i.css("display","").html(t):i.css("display","none"),this},showLoading:function(){return this.lightbox_body.html('<div class="modal-loading">'+this.options.loadingMessage+"</div>"),this},showYoutubeVideo:function(t){var i,e,o;return e=null!=this.$element.attr("data-norelated")||this.options.no_related?"&rel=0":"",o=this.checkDimensions(this.$element.data("width")||560),i=o/(560/315),this.showVideoIframe("//www.youtube.com/embed/"+t+"?badge=0&autoplay=1&html5=1"+e,o,i)},showVimeoVideo:function(t){var i,e;return e=this.checkDimensions(this.$element.data("width")||560),i=e/(500/281),this.showVideoIframe(t+"?autoplay=1",e,i)},showInstagramVideo:function(t){var i,e;return e=this.checkDimensions(this.$element.data("width")||612),this.resize(e),i=e+80,this.lightbox_body.html('<iframe width="'+e+'" height="'+i+'" src="'+this.addTrailingSlash(t)+'embed/" frameborder="0" allowfullscreen></iframe>'),this.options.onContentLoaded.call(this),this.modal_arrows?this.modal_arrows.css("display","none"):void 0},showVideoIframe:function(t,i,e){return e=e||i,this.resize(i),this.lightbox_body.html('<div class="embed-responsive embed-responsive-16by9"><iframe width="'+i+'" height="'+e+'" src="'+t+'" frameborder="0" allowfullscreen class="embed-responsive-item"></iframe></div>'),this.options.onContentLoaded.call(this),this.modal_arrows&&this.modal_arrows.css("display","none"),this},loadRemoteContent:function(i){var e,o;return o=this.$element.data("width")||560,this.resize(o),e=this.$element.data("disableExternalCheck")||!1,e||this.isExternal(i)?(this.lightbox_body.html('<iframe width="'+o+'" height="'+o+'" src="'+i+'" frameborder="0" allowfullscreen></iframe>'),this.options.onContentLoaded.call(this)):this.lightbox_body.load(i,t.proxy(function(t){return function(){return t.$element.trigger("loaded.bs.modal")}}(this))),this.modal_arrows&&this.modal_arrows.css("display","none"),this},isExternal:function(t){var i;return i=t.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/),"string"==typeof i[1]&&i[1].length>0&&i[1].toLowerCase()!==location.protocol?!0:"string"==typeof i[2]&&i[2].length>0&&i[2].replace(new RegExp(":("+{"http:":80,"https:":443}[location.protocol]+")?$"),"")!==location.host?!0:!1},error:function(t){return this.lightbox_body.html(t),this},preloadImage:function(i,e){var o;return o=new Image,(null==e||e===!0)&&(o.onload=function(i){return function(){var e;return e=t("<img />"),e.attr("src",o.src),e.addClass("img-responsive"),i.lightbox_body.html(e),i.modal_arrows&&i.modal_arrows.css("display","block"),e.load(function(){return i.options.scale_height?i.scaleHeight(o.height,o.width):i.resize(o.width),i.options.onContentLoaded.call(i)})}}(this),o.onerror=function(t){return function(){return t.error("Failed to load image: "+i)}}(this)),o.src=i,o},scaleHeight:function(i,e){var o,s,a,n,r,d;return n=this.modal_header.outerHeight(!0)||0,a=this.modal_footer.outerHeight(!0)||0,this.modal_footer.is(":visible")||(a=0),this.modal_header.is(":visible")||(n=0),o=this.border.top+this.border.bottom+this.padding.top+this.padding.bottom,r=parseFloat(this.modal_dialog.css("margin-top"))+parseFloat(this.modal_dialog.css("margin-bottom")),d=t(window).height()-o-r-n-a,s=Math.min(d/i,1),this.modal_dialog.css("height","auto").css("max-height",d),this.resize(s*e)},resize:function(i){var e;return e=i+this.border.left+this.padding.left+this.padding.right+this.border.right,this.modal_dialog.css("width","auto").css("max-width",e),this.lightbox_container.find("a").css("line-height",function(){return t(this).parent().height()+"px"}),this},checkDimensions:function(t){var i,e;return e=t+this.border.left+this.padding.left+this.padding.right+this.border.right,i=document.body.clientWidth,e>i&&(t=this.modal_body.width()),t},close:function(){return this.modal.modal("hide")},addTrailingSlash:function(t){return"/"!==t.substr(-1)&&(t+="/"),t}},t.fn.ekkoLightbox=function(e){return this.each(function(){var o;return o=t(this),e=t.extend({remote:o.attr("data-remote")||o.attr("href"),gallery_parent_selector:o.attr("data-parent"),type:o.attr("data-type")},e,o.data()),new i(this,e),this})},t.fn.ekkoLightbox.defaults={gallery_parent_selector:"document.body",left_arrow_class:".glyphicon .glyphicon-chevron-left",right_arrow_class:".glyphicon .glyphicon-chevron-right",directional_arrows:!0,type:null,always_show_close:!0,no_related:!1,scale_height:!0,loadingMessage:"Loading...",onShow:function(){},onShown:function(){},onHide:function(){},onHidden:function(){},onNavigate:function(){},onContentLoaded:function(){}}}).call(this),$(document).ready(function(){$("table.sortable").stupidtable(),$(document).on("click","table tr",function(t){var i=$(this).attr("data-url"),e=$(this).attr("data-type"),o=$(this).find("a");"undefined"!=typeof i&&"undefined"!=typeof e&&(t.preventDefault(),"folder"===e||"parent-folder"===e?window.location.href=i:"image"===e?o.first().ekkoLightbox({always_show_close:!1,loadingMessage:'<div class="text-center"><i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw margin-bottom"></i><span class="sr-only">Loading...</span></div>'}):(ga("send","event","Download",e,i),window.location.href=i))})}),function(t){t.fn.stupidtable=function(i){return this.each(function(){var e=t(this);i=i||{},i=t.extend({},t.fn.stupidtable.default_sort_fns,i),e.data("sortFns",i),e.on("click.stupidtable","thead th",function(){t(this).stupidsort()})})},t.fn.stupidsort=function(i){var e=t(this),o=0,s=t.fn.stupidtable.dir,a=e.closest("table"),n=e.data("sort")||null;if(null!==n){e.parents("tr").find("th").slice(0,t(this).index()).each(function(){var i=t(this).attr("colspan")||1;o+=parseInt(i,10)});var r;return 1==arguments.length?r=i:(r=i||e.data("sort-default")||s.ASC,e.data("sort-dir")&&(r=e.data("sort-dir")===s.ASC?s.DESC:s.ASC)),a.trigger("beforetablesort",{column:o,direction:r}),a.css("display"),setTimeout(function(){var i=[],d=a.data("sortFns"),l=d[n],h=a.children("tbody").children("tr:not([data-sort-ignore])");h.each(function(e,s){var a=t(s).children().eq(o),n=a.data("sort-value");if("undefined"==typeof n){var r=a.text();a.data("sort-value",r),n=r}i.push([n,s])}),i.sort(function(t,i){return l(t[0],i[0])}),r!=s.ASC&&i.reverse(),h=t.map(i,function(t){return t[1]}),a.children("tbody").append(h),a.find("th").data("sort-dir",null).removeClass("sorting-desc sorting-asc"),e.data("sort-dir",r).addClass("sorting-"+r),a.trigger("aftertablesort",{column:o,direction:r}),a.css("display")},10),e}},t.fn.updateSortVal=function(i){var e=t(this);return e.is("[data-sort-value]")&&e.attr("data-sort-value",i),e.data("sort-value",i),e},t.fn.stupidtable.dir={ASC:"asc",DESC:"desc"},t.fn.stupidtable.default_sort_fns={"int":function(t,i){return parseInt(t,10)-parseInt(i,10)},"float":function(t,i){return parseFloat(t)-parseFloat(i)},string:function(t,i){return t.localeCompare(i)},"string-ins":function(t,i){return t=t.toLocaleLowerCase(),i=i.toLocaleLowerCase(),t.localeCompare(i)}}}(jQuery);